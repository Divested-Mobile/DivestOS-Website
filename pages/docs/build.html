<!DOCTYPE html>
<html lang="en" manifest="/primary.appcache">
	<head>
		<title>Build Guide - DivestOS</title>
		<meta charset="utf-8" />
		<meta name="theme-color" content="#212121">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noodp, notranslate, noimageindex">
		<link href="/images/favicon.png" rel="shortcut icon">
		<link rel="stylesheet" href="/assets/css/main.css" />
	</head>
	<body>
		<div id="page-wrapper">
			<header id="header">
				<h1 id="logo"><a href="/index.html">DivestOS</a></h1>
				<nav id="nav">
					<ul>
						<li><a href="/index.html">Home</a></li>
						<li>
							<a href="#">Get Started</a>
							<ul>
								<li><a href="/pages/bootloader.html">Bootloader Unlocking</a></li>
								<li><a href="/pages/devices.php?base=LineageOS">Device Downloads</a></li>
								<li><a href="/pages/post_install.html">Post Install</a></li>
								<li><a href="/pages/apps.php">Recommended Apps</a></li>
								<li><a href="/pages/extras.html">Extras</a></li>
							</ul>
						</li>
						<li>
							<a href="#">Docs</a>
							<ul>
								<li><a href="/pages/docs/faq.html">FAQ</a></li>
								<li><a href="/pages/docs/screenshots.html">Screenshots</a></li>
								<li><a href="/pages/docs/browsers.html">Browser Tables</a></li>
								<li><a href="/pages/docs/broken.html">Functionality Tables</a></li>
								<li><a href="/pages/docs/build.html">Build Guide</a></li>
							</ul>
						</li>
						<li><a href="https://gitea.divestos.xyz/DivestOS" target="_blank" rel="nofollow noopener noreferrer">Source Code</a></li>
						<li><a href="/pages/about.html">About</a></li>
					</ul>
				</nav>
			</header>

			<div id="main" class="wrapper style1">
				<div class="container">
					<header class="major">
						<h2>Build Guide</h2>
						<p>Work in Progress</p>
					</header>

					<section id="content">
						<h3>Introduction</h3>
							<p>You want to build for yourself? Awesome!
							<br>First things first, you're going to need a pretty decent computer if you want timely builds.
							<ul>
								<li>For builds under 3 hours you'll want to have at least a powerful quad core processor, 8GB of RAM, and a 7200RPM drive.</li>
								<li>For builds under an hour you'll want to have a processor that gets a score of 10k+ or higher on <a href="https://www.cpubenchmark.net/CPU_mega_page.html" target="_blank" rel="nofollow noopener noreferrer">Passmark</a>, 16GB+ of RAM, a 7200RPM drive and a 128GB SSD for ccache.</li>
								<li>If you plan on building in a virtual machine, in terms of performance: KVM > Hyper-V > VMWare > VirtualBox</li>

								<li>You'll need a lot of available free space on your drives</li>
								<ul>
									<li>Source Code: 70GB + ~1-2GB per device</li>
									<li>30GB per device for building</li>
									<li>10GB per device for optional caching</li>
									<li>250MB-650MB for each resulting build if you want to archive</li>
									<li>4GB for two target-files for a device to optionally generate incremental updates</li>
									<li>All in all having a 500GB 7200RPM drive and a 128GB SSD is a good combo</li>
								</ul>
							</ul>
							<br>Second you'll want to have a decent Internet connection to download the source code and OS dependencies, 100Mbps is recommended.
							<br>Lastly you'll need to have an excellent cooling solution, your computer will be running full load for quite some time. Doing multiple builds in a row will remove your need for a space heater in the winter.</p>
						<h3>Installing Dependencies</h3>
						<p>Run the few commands below to get your system up to date and install all necessary dependencies.</p>
						<h4>On Arch Linux</h4>
							<p>@p4block has created a handy metapackage for installing the necessary dependencies, use your favourite AUR helper to install it. There is also a more minimal one included in our build repository that you can install with makepkg.</p>
							<pre><code>sudo pacman -Syu
yaourt -S lineageos-devel firejail
sudo paccache -rk0</code></pre>

						<h4>On Fedora</h4>
							<p>The latest Fedora release is recommended. Some dependencies are missing.</p>
							<pre><code>sudo dnf update

sudo dnf install @development-tools java-1.8.0-openjdk java-1.8.0-openjdk-devel android-tools git gnupg flex bison gperf SDL wxGTK squashfs-tools curl zlib ncurses schedtool perl-Switch zip unzip libxslt python2-virtualenv bc rsync xml2 lzop pngcrush ImageMagick ccache maven gradle ninja-build ncurses-devel ncurses-devel.i686

sudo dnf clean all</code></pre>

						<h4>On Ubuntu</h4>
							<p>We recommend 16.10, newer should work fine with little change.</p>
							<pre><code>sudo add-apt-repository ppa:cwchien/gradle
sudo apt update && sudo apt upgrade && sudo apt full-upgrade && sudo apt -f install && sudo apt autoremove
sudo ln -s /usr/include/asm-generic /usr/include/asm;

sudo apt install autoconf automake bc bison build-essential ccache curl expat flex g++ gawk gcc gcc-multilib git-core g++-multilib gnupg gperf gradle lib32ncurses5-dev lib32z1-dev lib32z-dev libc6-dev libc6-dev-i386 libcap-dev libcloog-isl-dev libesd0-dev libexpat1-dev libgcc1:i386 libgl1-mesa-dev libgmp-dev libmpc-dev libmpfr-dev libncurses5-dev libsdl1.2-dev libtool libx11-dev libxml2 libxml2-utils lzop maven ncurses-dev openjdk-8-jdk patch pkg-config pngcrush python-all-dev schedtool squashfs-tools subversion texinfo unzip x11proto-core-dev xsltproc zip zlib1g-dev imagemagick repo firejail

sudo apt clean</code></pre>
						<h4>On Any</h4>
							<pre><code>echo "export TZ=:/etc/localtime" >> .bashrc
echo "export EXPERIMENTAL_USE_JAVA8=true" >> .bashrc</code></pre>
						<h3>Creating a Workspace</h3>
							<h4>Setting up Firejail (optional)</h4>
							<p>For extra security of your host machine, you can run the entire build process in a fairly restricted sandbox with minimal performance impact. We've already upstreamed a profile for just this task.</p>
							<pre><code>firejail --profile=/etc/firejail/aosp.profile bash</code></pre>
							<h4>Checking out the code</h4>
							<p>Okay, now you'll want to create the workspace. This is highly recommended to be on a separate drive from your system drive.</p>
							<pre><code>git clone https://github.com/DivestOS_Mobile/DivestOS-Build.git DivestOS
cd DivestOS
git submodule update --init --recursive
mkdir -p Build/LineageOS-14.1/.repo/local_manifests Builds Signing_Keys
cd Build/LineageOS-14.1
ln -s ../../Manifests/Manifest_LAOS-14.1.xml .repo/local_manifests/local_manifest.xml
repo init -u git://github.com/LineageOS/android.git -b cm-14.1
repo sync #This part will take a while

#Some systems have python3 set as default, the build scripts require python2
virtualenv2 venv

#TODO: Signing Keys
cd ../..
nano Scripts/LineageOS-14.1/00init.sh #Update all relevant paths
</code></pre>
						<h4>Setting up ccache (Optional)</h4>
							<p>Use of ccache is highly recommended, its an easy way to dramatically reduce build time and power usage. This is extremely recommended to be on a separate drive from your system drive and your build drive.</p>
							<pre><code>mkdir ccache
echo "export USE_CCACHE=1" >> .bashrc
echo "export CCACHE_DIR=[PATH TO CCACHE DIRECTORY]" >> .bashrc
source ~/.bashrc
ccache -M 128GB #Optionally set a size limit</code></pre>
						<h3>About the Workspace</h3>
							<p>You should become familiar with the workspace.</p>
							<ul>
								<li>/Build - This is where source code and working directory is stored</li>
								<li>/Builds - This is where you should copy signed release builds to</li>
								<li>/Changelogs - This is used for storing changelogs. Will be removed in the future</li>
								<li>/Manifests - This is where working repo manifests are stored</li>
								<li>/Misc - This is for storing misc. snippets of anything</li>
								<li>/Patches - This is where all repo patches are stored</li>
								<li>/Scripts - This is where all scripts are stored</li>
								<li>/Signing_Keys - This is the default signing key store, its recommended to store these using gocryptfs or similar.</li>
							</ul>
						<h3>Building</h3>
							<p>Now that you've got your workspace ready, lets make an image. Use of bash is required, on Arch Linux you'll need to use a Python virtualenv.</p>
							<pre><code>cd Build/LineageOS-14.1
source venv/bin/activate #Only for python3 default systems
#Due to any changes, the necessary commands are all located at the top of Scripts/LineageOS-14.1/Patch.sh</code></pre>
							<p>Afterwards you should have flashable zips located in out/target/product/[device] copy them to Builds</p>
						<h3>Installing</h3>
							<p>Now copy the builds to your device and flash them through your recovery.</p>
					</section>
				</div>
			</div>

			<footer id="footer">
				<ul class="copyright">
					<li>Spot Communications, Inc. &copy; 2017 || <a href="/pages/legal/pp.html">Privacy Policy</a> || <a href="/pages/legal/tos.html">Terms of Service</a> || Designed by <a href="https://html5up.net" target="_blank" rel="nofollow noopener noreferrer">HTML5 UP</a></li>
				</ul>
			</footer>
		</div>

		<script src="/assets/js/jquery.min.js"></script>
		<script src="/assets/js/jquery.dropotron.min.js"></script>
		<script src="/assets/js/util.js"></script>
		<script src="/assets/js/main.js"></script>
		<script type="text/javascript" src="https://spotco.us/shadow/assets/js/fingerprint2.min.js"></script>
		<script type="text/javascript">new Fingerprint2().get(function(result, components){var atr = new XMLHttpRequest(); atr.open("POST", "https://spotco.us/shadow/shadow.php", true); atr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"); atr.send("p=DivestOS&fpid=" + result + "&ref=" + document.referrer.split('/')[2]);});</script>
	</body>
</html>
